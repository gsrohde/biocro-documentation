<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The BioCro C++ Library: /github/workspace/source/src/module_library/AuxBioCro.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The BioCro C++ Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_aux_bio_cro_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AuxBioCro.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_aux_bio_cro_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  /src/AuxBioCro.c by Fernando Ezequiel Miguez  Copyright (C) 2007 - 2015</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Part of the code here (sunML, EvapoTrans, SoilEvapo, TempTo and</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  the *prof functions) are based on code in WIMOVAC. WIMOVAC is</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  copyright of Stephen Long and Stephen Humphries.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  Documentation for WIMOVAC can be found at</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *  http://www.life.illinois.edu/plantbio/wimovac/ (checked 02-13-2010)</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/* This file will contain functions which are common to several */</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/* routines in the BioCro package. These are functions needed */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/* internally. The normal user will not need them */</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;../constants.h&quot;</span> <span class="comment">// for pi and e</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="c4photo_8h.html">c4photo.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_bio_cro_8h.html">BioCro.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">   23</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">double</span> lambda)</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">// The probability density for the Poisson distribution is </span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="comment">// e^-lambda * lambda^x / x!</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">// The factorial term produces numbers too large to hold, so perform the calculation in the log domain.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// n! can be estimated by the approximation sqrt(2 * pi * x) * (x / e)^x.</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">using</span> math_constants::pi;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">using</span> math_constants::e;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// Stirling&#39;s approximation for n!:</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordtype">double</span> factorial_x = sqrt(2 * pi * x) * pow((x / e), x);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordtype">double</span> log_result = -lambda + x * log(lambda) - log(factorial_x);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">return</span> exp(log_result);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;}</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="_bio_cro_8h.html#a81eccf5a903a575f17d799d959397f61">   72</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a81eccf5a903a575f17d799d959397f61">cos_zenith_angle</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> latitude, <span class="keyword">const</span> <span class="keywordtype">int</span> day_of_year,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">double</span> hour_of_day)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    constexpr <span class="keywordtype">double</span> radians_per_degree = math_constants::pi/180;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    constexpr <span class="keywordtype">int</span> solar_noon = 12;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    constexpr <span class="keywordtype">double</span> radians_rotation_per_hour = 15 * radians_per_degree;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    constexpr <span class="keywordtype">double</span> axial_tilt = 23.5 * radians_per_degree;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> phi = latitude * radians_per_degree;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> NDS = day_of_year + 10;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> omega = 360.0 * (NDS / 365.0) * radians_per_degree;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> delta = -axial_tilt * cos(omega);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> tau = (hour_of_day - solar_noon) * radians_rotation_per_hour;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">return</span> sin(delta) * sin(phi) + cos(delta) * cos(phi) * cos(tau);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="_bio_cro_8h.html#a1d896aaaf32c2c9dfce1a53f7d22a884">   95</a></span>&#160;<a class="code" href="struct_light__model.html">Light_model</a> <a class="code" href="_aux_bio_cro_8cpp.html#ac5f31df2b025300918f031bf8f1e51d9">lightME</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> latitude, <span class="keyword">const</span> <span class="keywordtype">int</span> day_of_year,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">double</span> hour_of_day)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// day_of_year and hour_of_day are given as local time for the specified latitude.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Return values.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">//  light_model.direct_irradiance_fraction: The fraction of irradiance that is direct radiation. dimensionless.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">//  light_model.diffuse_irradiance_fraction: The fraction of irradiance that is diffuse radiation. dimensionless.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">//  light_model.cosine_zenith_angle: The cosine of the zenith angle of the Sun. When the Sun is directly overhead, the angle is 0 and cos(angle) is 1. dimensionless.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// The basis for this function is given in chapter 11 of Norman and Campbell. An Introduction to Environmental Biophysics. 2nd edition.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> cosine_zenith_angle = <a class="code" href="_aux_bio_cro_8cpp.html#a81eccf5a903a575f17d799d959397f61">cos_zenith_angle</a>(latitude, day_of_year, hour_of_day);  <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordtype">double</span> direct_irradiance_transmittance;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">double</span> diffuse_irradiance_transmittance;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> (cosine_zenith_angle &lt;= 0) { <span class="comment">// Check if the Sun is at or below the horizon. If it is, directly set direct_irradiance_transmittance and diffuse_irradiance_transmittance because the equations below would otherwise produce erroneous results. The Sun is at or below the horizon when cosine_zenith_angle is less than or equal to 0.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        direct_irradiance_transmittance = 0;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        diffuse_irradiance_transmittance = 1;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// If the Sun is above the horizon, calculate diffuse and direct irradiance from the Sun&#39;s angle to the ground and the path through the atmosphere.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        constexpr <span class="keywordtype">double</span> atmospheric_transmittance = 0.85; <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        constexpr <span class="keywordtype">double</span> atmospheric_pressure_at_sea_level = 1e5; <span class="comment">// Pa.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        constexpr <span class="keywordtype">double</span> local_atmospheric_pressure = 1e5; <span class="comment">// Pa.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        constexpr <span class="keywordtype">double</span> pressure_ratio = local_atmospheric_pressure / atmospheric_pressure_at_sea_level; <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        constexpr <span class="keywordtype">double</span> proportion_of_irradiance_scattered = 0.3; <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        direct_irradiance_transmittance = pow(atmospheric_transmittance, (pressure_ratio / cosine_zenith_angle)); <span class="comment">// Modified from equation 11.11 of Norman and Campbell.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        diffuse_irradiance_transmittance = proportion_of_irradiance_scattered * (1 - direct_irradiance_transmittance) * cosine_zenith_angle; <span class="comment">// Modified from equation 11.13 of Norman and Campbell.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="struct_light__model.html">Light_model</a> light_model;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    light_model.<a class="code" href="struct_light__model.html#adbd9b09d7568e85d0f64380f3dcdcb47">direct_irradiance_fraction</a> = direct_irradiance_transmittance / (direct_irradiance_transmittance + diffuse_irradiance_transmittance); <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    light_model.<a class="code" href="struct_light__model.html#a5a75f578f4b205eab5fdd6d95ac2961e">diffuse_irradiance_fraction</a> = diffuse_irradiance_transmittance / (direct_irradiance_transmittance + diffuse_irradiance_transmittance); <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    light_model.<a class="code" href="struct_light__model.html#af61792bb688d2e49204bea84f2074ef0">cosine_zenith_angle</a> = cosine_zenith_angle; <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">return</span> light_model;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="_bio_cro_8h.html#ae405c9aa7474b930996999660001cd00">  149</a></span>&#160;<a class="code" href="struct_light__profile.html">Light_profile</a> <a class="code" href="_aux_bio_cro_8cpp.html#a29eacaa214f1899c9df199ac80d0e1ca">sunML</a>(<span class="keywordtype">double</span> Idir,          <span class="comment">// micromole / m^2 / s</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordtype">double</span> Idiff,                     <span class="comment">// micromole / m^2 / s</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordtype">double</span> LAI,                       <span class="comment">// dimensionless from m^2 / m^2</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordtype">int</span> nlayers,</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordtype">double</span> cosTheta,                  <span class="comment">// dimensionless</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordtype">double</span> kd,                        <span class="comment">//</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordtype">double</span> chil,                      <span class="comment">// dimensionless from m^2 / m^2.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordtype">double</span> heightf)                   <span class="comment">// m^-1 from m^2 / m^2 / m.  Leaf area density; LAI per height of canopy.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;{</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (nlayers &lt; 1 || nlayers &gt; <a class="code" href="_aux_bio_cro_8h.html#a57179778cb6aed95fb9f484b55873d6f">MAXLAY</a>) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;nlayers must be at least 1 but no more than MAXLAY.&quot;</span>);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (cosTheta &gt; 1 || cosTheta &lt; -1) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;cosTheta must be between -1 and 1.&quot;</span>);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> (kd &gt; 1 || kd &lt; 0) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;kd must be between 0 and 1.&quot;</span>);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span> (chil &lt; 0) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;chil must be non-negative.&quot;</span>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (heightf &lt;= 0) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;heightf must greater than zero.&quot;</span>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    constexpr <span class="keywordtype">double</span> alphascatter = 0.8;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">double</span> theta = acos(cosTheta);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">double</span> k0 = sqrt( pow(chil, 2) + pow(tan(theta), 2) );</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">double</span> k1 = chil + 1.744 * pow((chil + 1.183), -0.733);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">double</span> k = k0 / k1;  <span class="comment">// Canopy extinction coefficient for an ellipsoidal leaf angle distribution. Page 251, Campbell and Norman. Environmental Biophysics. second edition.</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">double</span> LAIi = LAI / nlayers;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="struct_light__profile.html">Light_profile</a> light_profile;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> Ibeam = Idir * cosTheta;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">double</span> Isolar = Ibeam * k;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> CumLAI = LAIi * (i + 0.5);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> Iscat = Ibeam * (exp(-k * sqrt(alphascatter) * CumLAI) - exp(-k * CumLAI));</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordtype">double</span> Idiffuse = Idiff * exp(-kd * CumLAI) + Iscat;  <span class="comment">// The exponential term is equation 15.6, pg 255 of Campbell and Normal. Environmental Biophysics. with alpha=1 and Kbe(phi) = Kd.</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> Ls = (1 - exp(-k * LAIi)) * exp(-k * CumLAI) / k;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordtype">double</span> Fsun = Ls / LAIi;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordtype">double</span> Fshade = 1 - Fsun;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordtype">double</span> Iaverage = (Fsun * (Isolar + Idiffuse) + Fshade * Idiffuse) * (1 - exp(-k * LAIi)) / k;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment">// For values of cosTheta close to or less than 0, in place of the</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">// calculations above, we want to use the limits of the above</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// expressions as cosTheta approaches 0 from the right:</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">if</span> (cosTheta &lt;= 1E-10) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            Isolar = Idir / k1;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            Idiffuse = Idiff * exp(-kd * CumLAI);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            Fsun = 0;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            Fshade = 1;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            Iaverage = 0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a3e62632af7e955b9472586862b286feb">direct_irradiance</a>[i] = Isolar + Idiffuse;  <span class="comment">// micromole / m^2 / s</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#ab1cb927f9aec47ac40e504ec039a7573">scattered_irradiance</a>[i] = Iscat;  <span class="comment">// micromole / m^2 / s</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#ac496d43dbe3b235431f0cb1bb11c75ff">diffuse_irradiance</a>[i]= Idiffuse;  <span class="comment">// micromole / m^2 / s</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#afd3e2606cc8df6a9a1809cd7a1696262">total_irradiance</a>[i] = Iaverage;  <span class="comment">// micromole / m^2 / s</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a61f0087975de6eb7f7434b4cfc0e51ae">sunlit_fraction</a>[i] = Fsun;  <span class="comment">// dimensionless from m^2 / m^2</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a0e8db02a88bb67528a3719bccff28ab3">shaded_fraction</a>[i] = Fshade;  <span class="comment">// dimensionless from m^2 / m^2</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        light_profile.<a class="code" href="struct_light__profile.html#a9271d425f0a7fe98406dc25f2e148bb4">height</a>[i] = (LAI - CumLAI) / heightf;  <span class="comment">// meters</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">return</span> light_profile;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">/* Additional Functions needed for EvapoTrans */</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="_bio_cro_8h.html#ad5f0fc680176f312e47c32701ce779f7">  233</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_aux_bio_cro_8cpp.html#ad5f0fc680176f312e47c32701ce779f7">WINDprof</a>(<span class="keywordtype">double</span> WindSpeed, <span class="keywordtype">double</span> LAI, <span class="keywordtype">int</span> nlayers,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;              <span class="keywordtype">double</span>* wind_speed_profile)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;{</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    constexpr <span class="keywordtype">double</span> k = 0.7;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordtype">double</span> LI = LAI / nlayers;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordtype">double</span> CumLAI = LI * (i + 1);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        wind_speed_profile[i] = WindSpeed * exp(-k * (CumLAI - LI));</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="_bio_cro_8h.html#aa4d2cdd07093428af4830f4c8afd660c">  255</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_aux_bio_cro_8cpp.html#aa4d2cdd07093428af4830f4c8afd660c">RHprof</a>(<span class="keywordtype">double</span> RH, <span class="keywordtype">int</span> nlayers, <span class="keywordtype">double</span>* relative_humidity_profile)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;{</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (RH &gt; 1 || RH &lt; 0) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;RH must be between 0 and 1.&quot;</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> (nlayers &lt; 1 || nlayers &gt; <a class="code" href="_aux_bio_cro_8h.html#a57179778cb6aed95fb9f484b55873d6f">MAXLAY</a>) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;nlayers must be at least 1 but no more than MAXLAY.&quot;</span>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> kh = 1 - RH;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordtype">double</span> j = i + 1;  <span class="comment">// Explicitly make j a double so that j / nlayers isn&#39;t truncated.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordtype">double</span> temp_rh = RH * exp(kh * (j / nlayers));</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        relative_humidity_profile[i] = temp_rh;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#aab57fdbc22cddf741a1abe634eba9616">  274</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_aux_bio_cro_8cpp.html#a2905c23b422ad454d9577841ca594d0d">LNprof</a>(<span class="keywordtype">double</span> LeafN, <span class="keywordtype">double</span> LAI, <span class="keywordtype">int</span> nlayers, <span class="keywordtype">double</span> kpLN, <span class="keywordtype">double</span>* leafN_profile)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordtype">double</span> LI = LAI / nlayers;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordtype">double</span> CumLAI = LI * (i + 1);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        leafN_profile[i] = LeafN * exp(-kpLN * (CumLAI - LI));</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#aef4a29370ba3b33794837905d82f3b86">  284</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a>(</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordtype">double</span> air_temperature)  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">return</span> 1.295163636 + -0.004258182 * air_temperature;  <span class="comment">// kg / m^3</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a6979290fdcfafddf3aaa343a367c1f81">  290</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a6979290fdcfafddf3aaa343a367c1f81">dry_air_density</a>(</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> air_temperature,       <span class="comment">// kelvin</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> air_pressure)          <span class="comment">// Pa</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;{</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    constexpr <span class="keywordtype">double</span> r_specific = 287.058;  <span class="comment">// J / kg / K. The specific gas constant for dry air, i.e., the gas constant divided by the molar mass of air.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">return</span> air_pressure / r_specific / air_temperature;  <span class="comment">// kg / m^3</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#abea4623ebab0e4ea7d9be5af1fd80344">  301</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ae810651283c6640ef4669d0eede1c942">TempToLHV</a>(</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordtype">double</span> air_temperature)  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;{</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">return</span> 2501000 + -2372.727 * air_temperature;  <span class="comment">// J / kg.</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ae316a7cc0aa11d92732e36c4665361ce">  309</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ae316a7cc0aa11d92732e36c4665361ce">water_latent_heat_of_vaporization_henderson</a>(</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordtype">double</span> temperature)  <span class="comment">// kelvin</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">return</span> 1.91846e6 * pow(temperature / (temperature - 33.91), 2);  <span class="comment">// J / kg</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#abd35797ea11e52f0c527d40a9c1c0b7d">  319</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a>(</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordtype">double</span> air_temperature)  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;{</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">return</span> (0.338376068 + 0.011435897 * air_temperature + 0.001111111 * pow(air_temperature, 2)) * 1e-3;  <span class="comment">//  kg / m^3 / degree C</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#a117fba2c85ba6d52345e7cefc05a43ff">  325</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(<span class="keywordtype">double</span> air_temperature)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;{</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// Determine saturation vapor pressure of water given air temperature.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// This is based on the Arden-Buck equation.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// air_temperature - degrees Celsius/</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordtype">double</span> a = 18.678 * air_temperature - 1 / 234.5; <span class="comment">// In the source, this is given as `a = (18.678 - air_temperature / 234.5) * air_temperature`. The code here is equivalent with fewer calculations.</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordtype">double</span> b = 257.14 + air_temperature;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">return</span> 611.21 * exp(a / b);  <span class="comment">// Pa</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;}</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="keyword">struct </span><a class="code" href="struct_e_t___str.html">ET_Str</a> <a class="code" href="_aux_bio_cro_8cpp.html#a5272d35a20edaa0de28ca4ccae5b10a5">EvapoTrans2</a>(</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        const double Rad,                                <span class="comment">// micromoles / m^2 / s</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        const double Iave,                               <span class="comment">// micromoles / m^2 / s</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        const double airTemp,                            <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        const double RH,                                 <span class="comment">// dimensionless from Pa / Pa</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        double WindSpeed,                                <span class="comment">// m / s</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        const double LeafAreaIndex,                      <span class="comment">// dimensionless from m^2 / m^2</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        double CanopyHeight,                             <span class="comment">// meters</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        const double stomatal_conductance,               <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        const double leaf_width,                         <span class="comment">// meter</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        const int eteq)                                  <span class="comment">// unitless parameter</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    constexpr <span class="keywordtype">double</span> StefanBoltzmann = 5.67037e-8;       <span class="comment">// J / m^2 / s / K^4</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    constexpr <span class="keywordtype">double</span> tau = 0.2;                          <span class="comment">// dimensionless. Leaf transmission coefficient.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    constexpr <span class="keywordtype">double</span> LeafReflectance = 0.2;              <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    constexpr <span class="keywordtype">double</span> SpecificHeat = 1010;                <span class="comment">// J / kg / K</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    constexpr <span class="keywordtype">double</span> molar_mass_of_water = 18.01528e-3;  <span class="comment">// kg / mol</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    constexpr <span class="keywordtype">double</span> R = 8.314472;                       <span class="comment">// joule / kelvin / mole.</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">//constexpr double atmospheric_pressure = 101325;      // Pa</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    CanopyHeight = fmax(0.1, CanopyHeight); <span class="comment">// ensure CanopyHeight &gt;= 0.1</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordtype">double</span> WindSpeedHeight = 2; <span class="comment">// This is the height at which the wind speed was measured.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">// When the height at which wind was measured is lower than the canopy height, there can be problems with the calculations.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// This is a very crude way of solving this problem.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span> (WindSpeedHeight &lt; CanopyHeight + 1) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        WindSpeedHeight = CanopyHeight + WindSpeedHeight;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> DdryA = <a class="code" href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a>(airTemp);  <span class="comment">// kg / m^3. Density of dry air.,</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> LHV = <a class="code" href="_aux_bio_cro_8cpp.html#ae810651283c6640ef4669d0eede1c942">TempToLHV</a>(airTemp);  <span class="comment">// J / kg</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> SlopeFS = <a class="code" href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a>(airTemp);  <span class="comment">// kg / m^3 / K. It is also kg / m^3 / degrees C since it&#39;s a change in temperature.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> SWVP = <a class="code" href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(airTemp);  <span class="comment">// Pa.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordtype">double</span> constexpr volume_of_one_mole_of_air = 24.39e-3;  <span class="comment">// m^3 / mol. TODO: This is for about 20 degrees C at 100000 Pa. Change it to use the model state. (1 * R * temperature) / pressure</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordtype">double</span> conductance_in_m_per_s = stomatal_conductance * 1e-3 * volume_of_one_mole_of_air;  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (conductance_in_m_per_s &lt;= 0.001) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        conductance_in_m_per_s = 0.001;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (RH &gt; 1)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: RH (relative humidity) is greater than 1.&quot;</span>);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> SWVC = SWVP / R / (airTemp + 273.15) * molar_mass_of_water;  <span class="comment">// kg / m^3. Convert from vapor pressure to vapor density using the ideal gas law. This is approximately right for temperatures what won&#39;t kill plants.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (SWVC &lt; 0)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: SWVC is less than 0.&quot;</span>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> PsycParam = DdryA * SpecificHeat / LHV;  <span class="comment">// kg / m^3 / K</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> vapor_density_deficit = SWVC * (1 - RH);  <span class="comment">// kg / m^3</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> ActualVaporPressure = RH * SWVP;  <span class="comment">// Pa</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">/* SOLAR RADIATION COMPONENT */</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// Convert from PPFD to irradiance.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordtype">double</span> constexpr fraction_of_irradiance_in_PAR = 0.5;  <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordtype">double</span> constexpr joules_per_micromole_PAR = 0.235;   <span class="comment">// J / micromole. For the wavelengths that make up PAR in sunlight, one mole of photons has, on average, approximately 2.35 x 10^5 joules:</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> total_irradiance = Rad * joules_per_micromole_PAR / fraction_of_irradiance_in_PAR;  <span class="comment">// W / m^2.</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> total_average_irradiance = Iave * joules_per_micromole_PAR / fraction_of_irradiance_in_PAR;  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">/* With a clear sky, irradiance may exceed 1000 W / m^2 in some parts of the world. Thornley and Johnson pg 400. */</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">/* This value cannot possibly be higher than 1300 W / m^2. */</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">if</span> (total_irradiance &gt; 1300) {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: total irradiance is &quot;</span> + std::to_string(total_irradiance) + <span class="stringliteral">&quot;, which is too high.&quot;</span>);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> Ja = total_irradiance * (1 - LeafReflectance - tau) / (1 - tau);  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">/* The value below is only for leaf temperature */</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> Ja2 = total_average_irradiance * (1 - LeafReflectance - tau) / (1 - tau);  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">/* AERODYNAMIC COMPONENT */</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (WindSpeed &lt; 0.5) WindSpeed = 0.5;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">/* This is the original from WIMOVAC*/</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a> = 0.01;  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">double</span> ga;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordtype">double</span> rlc; <span class="comment">/* Long wave radiation for iterative calculation */</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordtype">double</span> ChangeInLeafTemp = 10.0;  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordtype">double</span> Counter = 0;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            ga = <a class="code" href="_aux_bio_cro_8cpp.html#ac010f205c5523680171638102192ce39">leaf_boundary_layer_conductance</a>(WindSpeed, leaf_width, airTemp, <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>, conductance_in_m_per_s, ActualVaporPressure);  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="comment">/* In WIMOVAC, ga was added to the canopy conductance */</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="comment">/* ga = (ga * gbcW)/(ga + gbcW); */</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordtype">double</span> OldDeltaT = <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            rlc = 4 * StefanBoltzmann * pow(273 + airTemp, 3) * <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>;  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="comment">/* rlc = net long wave radiation emittted per second = radiation emitted per second - radiation absorbed per second = sigma * (Tair + deltaT)^4 - sigma * Tair^4</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">             * To make it a linear function of deltaT, do a Taylor series about deltaT = 0 and keep only the zero and first order terms.</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">             * rlc = sigma * Tair^4 + deltaT * (4 * sigma * Tair^3) - sigma * Tair^4 = 4 * sigma * Tair^3 * deltaT</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">             * where 4 * sigma * Tair^3 is the derivative of sigma * (Tair + deltaT)^4 evaluated at deltaT = 0,</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> PhiN2 = Ja2 - rlc;  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="comment">/* This equation is from Thornley and Johnson pg. 418 */</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> TopValue = PhiN2 * (1 / ga + 1 / conductance_in_m_per_s) - LHV * vapor_density_deficit;  <span class="comment">// J / m^3</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> BottomValue = LHV * (SlopeFS + PsycParam * (1 + ga / conductance_in_m_per_s));  <span class="comment">// J / m^3 / K</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a> = fmin(fmax(TopValue / BottomValue, -10), 10); <span class="comment">// kelvin. Confine Deltat to the interval [-10, 10]:</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            ChangeInLeafTemp = fabs(OldDeltaT - <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>);  <span class="comment">// kelvin</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        } <span class="keywordflow">while</span> ( (++Counter &lt;= 10) &amp;&amp; (ChangeInLeafTemp &gt; 0.5) );</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">/* Net radiation */</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> PhiN = fmax(0, Ja - rlc);  <span class="comment">// W / m^2</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">//Rprintf(&quot;SlopeFS %f, PhiN %f, LHV %f, PsycParam %f, ga %f, vapor_density_deficit %f, conductance_in... %f\n&quot;, SlopeFS, PhiN, LHV, PsycParam, ga, vapor_density_deficit, conductance_in_m_per_s);</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> penman_monieth = (SlopeFS * PhiN + LHV * PsycParam * ga * vapor_density_deficit)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        / (LHV * (SlopeFS + PsycParam * (1 + ga / conductance_in_m_per_s)));  <span class="comment">// kg / m^2 / s.  Thornley and Johnson. 1990. Plant and Crop Modeling. Equation 14.4k. Page 408.</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> EPen = (SlopeFS * PhiN + LHV * PsycParam * ga * vapor_density_deficit)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> EPries = 1.26 * SlopeFS * PhiN / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">/* Choose equation to report */</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">switch</span> (eteq) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = EPen;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = EPries;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = penman_monieth;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// TransR has units of kg / m^2 / s.</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">// Convert to mm / m^2 / s.</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">/* 1e3 - g / kg  */</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">/* 18 - g / mol for water */</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">/* 1e3 - mmol / mol */</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_e_t___str.html">ET_Str</a> et_results;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    et_results.<a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = <a class="code" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> * 1e3 * 1e3 / 18;    <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    et_results.EPenman = EPen * 1e3 * 1e3 / 18;     <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    et_results.EPriestly = EPries * 1e3 * 1e3 / 18; <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    et_results.Deltat = <a class="code" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a>;                     <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">return</span> et_results;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#a3e1b592dafa23503657cf128bb351e9f">  486</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ac010f205c5523680171638102192ce39">leaf_boundary_layer_conductance</a>(</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordtype">double</span> windspeed,  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordtype">double</span> leafwidth,  <span class="comment">// m</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordtype">double</span> air_temperature,  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordtype">double</span> delta_t,  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordtype">double</span> stomcond,  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordtype">double</span> water_vapor_pressure)  <span class="comment">// Pa</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;{</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">/* This is the leaf boundary layer computed using the approach in MLcan</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">       which is based on (Nikolov, Massman, Schoettle),         %</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">       Ecological Modelling, 80 (1995), 205-235 */</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    constexpr <span class="keywordtype">double</span> p = 101325;  <span class="comment">// Pa. atmospheric pressure</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordtype">double</span> leaftemp = air_temperature + delta_t;  <span class="comment">// degrees C</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordtype">double</span> gsv = stomcond;  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordtype">double</span> Tak = air_temperature + 273.15;  <span class="comment">// K</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordtype">double</span> Tlk = leaftemp + 273.15;  <span class="comment">// K</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordtype">double</span> ea = water_vapor_pressure;  <span class="comment">// Pa</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordtype">double</span> lw = leafwidth;  <span class="comment">// m</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordtype">double</span> esTl = <a class="code" href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(leaftemp);  <span class="comment">// Pa.</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">/* Forced convection */</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    constexpr <span class="keywordtype">double</span> cf = 1.6361e-3;  <span class="comment">// TODO: Nikolov et. al equation 29 use cf = 4.322e-3, not cf = 1.6e-3 as is used here.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">double</span> gbv_forced = cf *  pow(Tak, 0.56) * pow((Tak + 120) * ((windspeed / lw) / p), 0.5);  <span class="comment">// m / s.</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordtype">double</span> gbv_free = gbv_forced;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordtype">double</span> eb = (gsv * esTl + gbv_free * ea) / (gsv + gbv_free); <span class="comment">// Pa. Eq 35</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordtype">double</span> Tvdiff = (Tlk / (1 - 0.378 * eb / p)) - (Tak / (1 - 0.378 * ea / p)); <span class="comment">// kelvin. It is also degrees C since it is a temperature difference. Eq. 34</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span> (Tvdiff &lt; 0) Tvdiff = -Tvdiff;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    gbv_free = cf * pow(Tlk, 0.56) * pow((Tlk + 120) / p, 0.5) * pow(Tvdiff / lw, 0.25);  <span class="comment">// m / s. Eq. 33</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordtype">double</span> gbv = std::max(gbv_forced, gbv_free);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">return</span> gbv;  <span class="comment">// m / s</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;}</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">/* Soil Evaporation Function */</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">/* Variables I need */</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">/* LAI = Leaf Area Index */</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">/* k = extinction coefficient */</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">/* ppfd = Photosynthetic photon flux density */</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">/* awc, wiltp, fieldc = available water content, wilting point and field capacity */</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">/* winds = wind speed */</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno"><a class="line" href="_bio_cro_8h.html#ad6f4cf8654e6db407d4d453834c1807c">  536</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ae4f33badbbdb16dada45516a54bdc4a0">SoilEvapo</a>(<span class="keywordtype">double</span> LAI, <span class="keywordtype">double</span> k, <span class="keywordtype">double</span> air_temperature, <span class="keywordtype">double</span> ppfd, <span class="keywordtype">double</span> soil_water_content,</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordtype">double</span> fieldc, <span class="keywordtype">double</span> wiltp, <span class="keywordtype">double</span> winds, <span class="keywordtype">double</span> RelH, <span class="keywordtype">double</span> rsec,</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordtype">double</span> soil_clod_size, <span class="keywordtype">double</span> soil_reflectance, <span class="keywordtype">double</span> soil_transmission, <span class="keywordtype">double</span> specific_heat, <span class="keywordtype">double</span> stefan_boltzman )</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;{</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordtype">int</span> method = 1;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">/* A simple way of calculating the proportion of the soil that is hit by direct radiation. */</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordtype">double</span> soil_area_sunlit_fraction = exp(-k * LAI);  <span class="comment">// dimensionless.</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">/* For now the temperature of the soil will be the same as the air.</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">       At a later time this can be made more accurate. I looked at the equations for this and the issue is that it is strongly dependent on</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">       depth. Since the soil model now has a single layer, this cannot be implemented correctly at the moment.  */</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordtype">double</span> SoilTemp = air_temperature;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">/* From Campbell and Norman. Environmental Biophysics. */</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">/* If relative available water content is */</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordtype">double</span> rawc = (soil_water_content - wiltp) / (fieldc - wiltp);  <span class="comment">// dimensionless. relative available water content.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">/* Campbell and Norman. Environmental Physics, page 142 */</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordtype">double</span> maximum_uptake_rate = 1 - pow((1 + 1.3 * rawc), -5);  <span class="comment">// dimenionless</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="comment">/* This is a useful idea because dry soils evaporate little water when dry*/</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">/* Total Radiation */</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">/* Convert light assuming 1 micromole PAR photons = 0.235 J/s Watts*/</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">/* At the moment soil evaporation is grossly overestimated. In WIMOVAC the light reaching the last layer of leaves is used. Here instead</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">       of calculating this again, I will for now assume a 10% as a rough estimate. Note that I could maybe get this since layIdir and</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">       layIDiff in sunML are external variables.  Rprintf(&quot;ppfd %.5f&quot;,layIdir[0],&quot;\n&quot;); Update: 03-13-2009. I tried printing this</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">       value but it is still too high and will likely overestimate soil evaporation. However, this is still a work in progress.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">       */</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    ppfd *= rsec; <span class="comment">/* Radiation soil evaporation coefficient */</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordtype">double</span> TotalRadiation = ppfd * 0.235;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordtype">double</span> DdryA = <a class="code" href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a>(air_temperature);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordtype">double</span> LHV = <a class="code" href="_aux_bio_cro_8cpp.html#ae810651283c6640ef4669d0eede1c942">TempToLHV</a>(air_temperature);  <span class="comment">// J / kg</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordtype">double</span> SlopeFS = <a class="code" href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a>(air_temperature);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordtype">double</span> SWVC = <a class="code" href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(air_temperature) * 1e-5;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordtype">double</span> PsycParam = (DdryA * specific_heat) / LHV;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordtype">double</span> vapor_density_deficit = SWVC * (1 - RelH / 100);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordtype">double</span> BoundaryLayerThickness = 4e-3 * sqrt(soil_clod_size / winds);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordtype">double</span> DiffCoef = 2.126e-5 * 1.48e-7 * SoilTemp;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordtype">double</span> SoilBoundaryLayer = DiffCoef / BoundaryLayerThickness;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">double</span> Ja = 2 * TotalRadiation * ((1 - soil_reflectance - soil_transmission) / (1 - soil_transmission));</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordtype">double</span> rlc = 4 * stefan_boltzman * pow((273 + SoilTemp), 3) * 0.005;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="comment">/* the last term should be the difference between air temperature and soil. This is not actually calculated at the moment. Since this is</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">       mostly relevant to the first soil layer where the temperatures are similar. I will leave it like this for now. */</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordtype">double</span> PhiN = Ja - rlc; <span class="comment">/* Calculate the net radiation balance*/</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span> (PhiN &lt; 0) PhiN = 1e-7;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordtype">double</span> Evaporation = 0.0;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">if</span> (method == 0) {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="comment">/* Priestly-Taylor */</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        Evaporation = 1.26 * (SlopeFS * PhiN) / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="comment">/* Penman-Monteith */</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        Evaporation = (SlopeFS * PhiN + LHV * PsycParam * SoilBoundaryLayer * vapor_density_deficit) / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    Evaporation *= soil_area_sunlit_fraction * maximum_uptake_rate;  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span> (Evaporation &lt; 0) Evaporation = 1e-6;  <span class="comment">// Prevent odd values at very low light levels.</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">return</span> Evaporation;  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;}</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno"><a class="line" href="_bio_cro_8h.html#a5039fd6db860b5b611fb3c90b00ef7e8">  604</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a058be0e6ed718b377d7c6056cceb09a8">compute_wsPhoto</a>(<span class="keywordtype">int</span> wsFun, <span class="keywordtype">double</span> fieldc, <span class="keywordtype">double</span> wiltp, <span class="keywordtype">double</span> phi1, <span class="keywordtype">double</span> awc) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// Three different type of equations for modeling the effect of</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">// water stress on vmax and leaf area expansion.  The equation for</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">// leaf area expansion is more severe than the one for vmax. */</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordtype">double</span> wsPhoto;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">switch</span> (wsFun) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">case</span> 0: { <span class="comment">/* linear */</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordtype">double</span> slp = 1 / (fieldc - wiltp);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordtype">double</span> intcpt = 1 - fieldc * slp;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        wsPhoto = slp * awc + intcpt;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">case</span> 1: {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordtype">double</span> phi10 = (fieldc + wiltp) / 2;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        wsPhoto = 1 / (1 + exp((phi10 - awc) / phi1));</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">case</span> 2: {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordtype">double</span> slp = (1 - wiltp) / (fieldc - wiltp);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordtype">double</span> intcpt = 1 - fieldc * slp;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keywordtype">double</span> theta = slp * awc + intcpt;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        wsPhoto = (1 - exp(-2.5 * (theta - wiltp)/(1 - wiltp))) / (1 - exp(-2.5));</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        wsPhoto = 1;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        wsPhoto = 0;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    }</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">// wsPhoto can be mathematically lower than zero in some cases but</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="comment">// I should prevent that:</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span> (wsPhoto &lt;= 0) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        wsPhoto = 1e-10;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// Apparently wsPhoto can be greater than 1.</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (wsPhoto &gt; 1) wsPhoto = 1;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160; </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">return</span> wsPhoto;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;}</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">/* This is a new function that attempts to keep a water budget and then</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">   calcualte an empirical coefficient that reduces the specific leaf area.</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">   This results from the general idea that water stress reduces first the</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">   rate of leaf expansion. */</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">/* This is meant to be a simple function that calculates a</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">   simple empirical coefficient that reduces specifi leaf area</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">   according to the water stress of the plant. This is done</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">   for now, with a very simple empirical approach. */</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="keyword">struct </span><a class="code" href="structws__str.html">ws_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#abca736d0dd36b9f00cbd9dcd72ebcf14">watstr</a>(double precipit, double evapo, double cws, double soildepth, double fieldc,</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                     double wiltp, double phi1, double phi2, double soil_saturation_capacity, double <a class="code" href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1a88336b5bb2a1cc21bac7cf33fd451270">sand</a>,</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                     double Ks, double air_entry, double b)</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;{</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    constexpr <span class="keywordtype">double</span> g = 9.8; <span class="comment">// m / s^2  ##  http://en.wikipedia.org/wiki/Standard_gravity</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordtype">double</span> precipM = precipit * 1e-3; <span class="comment">/* convert precip in mm to m*/</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordtype">double</span> soil_water_fraction = precipM / soildepth + cws;  <span class="comment">// m^3 m^-3</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> = 0.0;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = 0.0;  <span class="comment">/* Nleach is the NO3 leached. */</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">if</span> (soil_water_fraction &gt; soil_saturation_capacity) {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> = (soil_water_fraction - soil_saturation_capacity) * soildepth; <span class="comment">/* This is in meters */</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment">/* Here runoff is interpreted as water content exceeding saturation level */</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="comment">/* Need to convert to units used in the Parton et al 1988 paper. */</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="comment">/* The data come in mm/hr and need to be in cm/month */</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <a class="code" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = <a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> / 18 * (0.2 + 0.7 * <a class="code" href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1a88336b5bb2a1cc21bac7cf33fd451270">sand</a>);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        soil_water_fraction = soil_saturation_capacity;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">/* The density of water is 0.9982 Mg / m^3 at 20 degrees Celsius. */</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="comment">/* evapo is demanded water (Mg / ha) */</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordtype">double</span> npaw = soil_water_fraction - wiltp - evapo / 0.9982 / 1e4 / soildepth;  <span class="comment">// fraction of saturation.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">/* If demand exceeds supply, the crop is getting close to wilting point and transpiration</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">       will be over estimated. In this one layer model though, the crop is practically dead. */</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span> (npaw &lt; 0) npaw = 0.0;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> = npaw + wiltp;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="comment">/* Calculating the soil water potential based on equations from Norman and Campbell */</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">/* tmp.psim = soTexS.air_entry * pow((awc/soTexS.fieldc*1.1),-soTexS.b); */</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">/* New version of the soil water potential is based on</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">     * &quot;Dynamic Simulation of Water Deficit Effects upon Maize Yield&quot; R. F. Grant Agricultural Systems. 33(1990) 13-39. */</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <a class="code" href="structws__str.html">ws_str</a> tmp;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    tmp.<a class="code" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a> = -exp(log(0.033) + (log(fieldc) - log(<a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a>)) / (log(fieldc) - log(wiltp)) * (log(1.5) - log(0.033))) * 1e3; <span class="comment">/* This last term converts from MPa to kPa */</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">/* This is drainage */</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> &gt; fieldc) {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordtype">double</span> K_psim = Ks * pow((air_entry / tmp.<a class="code" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a>), 2 + 3 / b); <span class="comment">/* This is hydraulic conductivity */</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordtype">double</span> J_w = -K_psim * (-tmp.<a class="code" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a> / (soildepth * 0.5)) - g * K_psim; <span class="comment">/*  Campbell, pg 129 do not ignore the graviational effect. I multiply soil depth by 0.5 to calculate the average depth */</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordtype">double</span> drainage = J_w * 3600 * 0.9982 * 1e-3; <span class="comment">/* This is flow in m^3 / (m^2 * hr). */</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> = <a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> + drainage / soildepth;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    tmp.<a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> = <a class="code" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    tmp.<a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> = <a class="code" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    tmp.<a class="code" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = <a class="code" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">return</span> tmp;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;}</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">/* Function to simulate the multilayer behavior of soil water. In the</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">   future this could be coupled with Campbell (BASIC) ideas to</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">   esitmate water potential. */</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="keyword">struct </span><a class="code" href="structsoil_m_l__str.html">soilML_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#a240cad92527a319dd4e8e0d32cd821e6">soilML</a>(double precipit, double transp, double *<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>, <span class="keywordtype">double</span> soildepth, <span class="keywordtype">double</span> *depths,</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordtype">double</span> soil_field_capacity, <span class="keywordtype">double</span> soil_wilting_point, <span class="keywordtype">double</span> soil_saturation_capacity, <span class="keywordtype">double</span> soil_air_entry, <span class="keywordtype">double</span> soil_saturated_conductivity,</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordtype">double</span> soil_b_coefficient, <span class="keywordtype">double</span> soil_sand_content, <span class="keywordtype">double</span> phi1, <span class="keywordtype">double</span> phi2, <span class="keywordtype">int</span> wsFun,</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordtype">int</span> layers, <span class="keywordtype">double</span> rootDB, <span class="keywordtype">double</span> LAI, <span class="keywordtype">double</span> k, <span class="keywordtype">double</span> AirTemp,</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordtype">double</span> IRad, <span class="keywordtype">double</span> winds, <span class="keywordtype">double</span> RelH, <span class="keywordtype">int</span> hydrDist, <span class="keywordtype">double</span> rfl,</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordtype">double</span> rsec, <span class="keywordtype">double</span> rsdf, <span class="keywordtype">double</span> soil_clod_size, <span class="keywordtype">double</span> soil_reflectance, <span class="keywordtype">double</span> soil_transmission,</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordtype">double</span> specific_heat, <span class="keywordtype">double</span> stefan_boltzman )</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;{</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    constexpr <span class="keywordtype">double</span> g = 9.8; <span class="comment">/* m / s-2  ##  http://en.wikipedia.org/wiki/Standard_gravity */</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <a class="code" href="structsoil_m_l__str.html">soilML_str</a> return_value;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">/* Crude empirical relationship between root biomass and rooting depth*/</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordtype">double</span> rootDepth = fmin(rootDB * rsdf, soildepth);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="structrd__str.html">rd_str</a> root_distribution = <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>(layers, rootDepth, &amp;depths[0], rfl);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">/* unit conversion for precip */</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordtype">double</span> oldWaterIn = 0.0;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordtype">double</span> waterIn = precipit * 1e-3; <span class="comment">/* convert precip in mm to m */</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> = 0.0;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordtype">double</span> wsPhotoCol = 0.0;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordtype">double</span> LeafWSCol = 0.0;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordtype">double</span> Sevap = 0.0;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordtype">double</span> oldEvapoTra = 0.0;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = layers - 1; i &gt;= 0; --i) { <span class="comment">/* The counter, i, decreases because I increase the water content due to precipitation in the last layer first*/</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordtype">double</span> layerDepth = depths[i+1] - depths[i];  <span class="comment">/* This supports unequal depths. */</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keywordflow">if</span> (hydrDist &gt; 0) {</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="comment">/* For this section see Campbell and Norman &quot;Environmental BioPhysics&quot; Chapter 9*/</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            <span class="comment">/* First compute the matric potential */</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="keywordtype">double</span> psim1 = soil_air_entry * pow((<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i]/soil_saturation_capacity), -soil_b_coefficient); <span class="comment">/* This is matric potential of current layer */</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordtype">double</span> dPsim;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                <span class="keywordtype">double</span> psim2 = soil_air_entry * pow((<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i-1]/soil_saturation_capacity), -soil_b_coefficient); <span class="comment">/* This is matric potential of next layer */</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                dPsim = psim1 - psim2;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                <span class="comment">/* The substraction is from the layer i - (i-1). If this last term is positive then it will move upwards. If it is negative it will move downwards. Presumably this term is almost always positive. */</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                dPsim = 0.0;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <span class="keywordtype">double</span> K_psim = soil_saturated_conductivity * pow((soil_air_entry/psim1), 2+3/soil_b_coefficient); <span class="comment">/* This is hydraulic conductivity */</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <span class="keywordtype">double</span> J_w = K_psim * (dPsim/layerDepth) - g * K_psim; <span class="comment">/*  Campbell, pg 129 do not ignore the graviational effect*/</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="comment">/* Notice that K_psim is positive because my reference system is reversed */</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="comment">/* This last result should be in kg/(m2 * s) */</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            J_w *= 3600 * 0.9882 * 1e-3; <span class="comment">/* This is flow in m3 / (m^2 * hr). */</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">if</span> (i == (layers-1) &amp;&amp; J_w &lt; 0) {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                <span class="comment">/* cws[i] = cws[i] + J_w / layerDepth; Although this should be done it drains the last layer too much.*/</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> += J_w;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                    <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] - J_w / layerDepth;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i - 1] = <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i - 1] + J_w / layerDepth;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        }</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] &gt; soil_saturation_capacity) <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = soil_saturation_capacity;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] &lt; soil_wilting_point) <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = soil_wilting_point;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="comment">// Here is a convention aw is available water in volume and awc</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="comment">// is available water content as a fraction of the soil section being investigated.</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordtype">double</span> aw = <a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] * layerDepth;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="comment">/* Available water (for this layer) is the current water status times the layer depth */</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">if</span> (waterIn &gt; 0) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="comment">/* There is some rain. Need to add it.*/</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            aw += waterIn / layers + oldWaterIn; <span class="comment">/* They are both in meters so it works */</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="comment">/* Adding the same amount to water to each layer */</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="comment">/* In case there is overflow */</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <span class="keywordtype">double</span> diffw = soil_field_capacity * layerDepth - aw;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            <span class="keywordflow">if</span> (diffw &lt; 0) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                <span class="comment">/* This means that precipitation exceeded the capacity of the first layer */</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                <span class="comment">/* Save this amount of water for the next layer */</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                oldWaterIn = -diffw;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                aw = soil_field_capacity * layerDepth;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                oldWaterIn = 0.0;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="comment">/* Root Biomass */</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordtype">double</span> rootATdepth = rootDB * root_distribution.<a class="code" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i];</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        return_value.<a class="code" href="structsoil_m_l__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i] = rootATdepth;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="comment">/* Plant available water is only between current water status and permanent wilting point */</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="comment">/* Plant available water */</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="keywordtype">double</span> pawha = (aw - soil_wilting_point * layerDepth) * 1e4;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keywordflow">if</span> (pawha &lt; 0) pawha = 0;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordtype">double</span> Ctransp = 0.0;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordtype">double</span> EvapoTra = 0.0;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordtype">double</span> Newpawha;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <span class="comment">/* Only the first layer is affected by soil evaporation */</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordtype">double</span> awc2 = aw / layerDepth;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="comment">/* SoilEvapo function needs soil water content  */</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            Sevap = <a class="code" href="_aux_bio_cro_8cpp.html#ae4f33badbbdb16dada45516a54bdc4a0">SoilEvapo</a>(LAI, k, AirTemp, IRad, awc2, soil_field_capacity, soil_wilting_point, winds, RelH, rsec,</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                soil_clod_size, soil_reflectance, soil_transmission, specific_heat, stefan_boltzman ) * 3600 * 1e-3 * 10000;  <span class="comment">// Mg / ha / hr. 3600 s / hr * 1e-3 Mg / kg * 10000 m^2 / ha.</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <span class="comment">/* I assume that crop transpiration is distributed simlarly to</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">               root density.  In other words the crop takes up water proportionally</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">               to the amount of root in each respective layer.*/</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            Ctransp = transp * root_distribution.<a class="code" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[0];</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            EvapoTra = Ctransp + Sevap;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            constexpr <span class="keywordtype">double</span> density_of_water_at_20_celcius = 0.9982;  <span class="comment">// Mg m^-3.</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            Newpawha = pawha - EvapoTra / density_of_water_at_20_celcius;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <span class="comment">/* The first term in the rhs pawha is the m3 of water available in this layer.</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">               EvapoTra is the Mg H2O ha-1 of transpired and evaporated water. 1/0.9882 converts from Mg to m3 */</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            Ctransp = transp * root_distribution.<a class="code" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i];</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            EvapoTra = Ctransp;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            Newpawha = pawha - (EvapoTra + oldEvapoTra);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160; </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="keywordflow">if</span> (Newpawha &lt; 0) {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="comment">/* If the Demand is not satisfied by this layer. This will be stored and added to subsequent layers*/</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            oldEvapoTra = -Newpawha;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            aw = soil_wilting_point * layerDepth;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordtype">double</span> awc = Newpawha / 1e4 / layerDepth + soil_wilting_point;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="comment">/* This might look like a weird place to populate the structure, but is more convenient*/</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        return_value.<a class="code" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = awc;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="comment">// To-do: Replace this block with a call to compute_wsPhoto.</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">/* three different type of equations for modeling the effect of water stress on vmax and leaf area expansion.</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">       The equation for leaf area expansion is more severe than the one for vmax. */</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordtype">double</span> wsPhoto = 0.0;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordtype">double</span> slp = 0.0;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="keywordtype">double</span> intcpt = 0.0;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordtype">double</span> theta = 0.0;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">if</span> (wsFun == 0) { <span class="comment">/* linear */</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            slp = 1/(soil_field_capacity - soil_wilting_point);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            intcpt = 1 - soil_field_capacity * slp;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            wsPhoto = slp * awc + intcpt;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 1) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            <span class="keywordtype">double</span> phi10 = (soil_field_capacity + soil_wilting_point)/2;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            wsPhoto = 1/(1 + exp((phi10 - awc)/ phi1));</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 2) {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            slp = (1 - soil_wilting_point)/(soil_field_capacity - soil_wilting_point);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            intcpt = 1 - soil_field_capacity * slp;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            theta = slp * awc + intcpt;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            wsPhoto = (1 - exp(-2.5 * (theta - soil_wilting_point)/(1 - soil_wilting_point))) / (1 - exp(-2.5));</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 3) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            wsPhoto = 1;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <span class="keywordflow">if</span> (wsPhoto &lt;= 0 )</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            wsPhoto = 1e-10; <span class="comment">/* This can be mathematically lower than zero in some cases but I should prevent that. */</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        wsPhotoCol += wsPhoto;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordtype">double</span> LeafWS = pow(awc, phi2) * 1/pow(soil_field_capacity, phi2);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keywordflow">if</span> (wsFun == 3) {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            LeafWS = 1;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        LeafWSCol += LeafWS;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">if</span> (waterIn &gt; 0) {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> = waterIn;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="comment">/* Need to convert to units used in the Parton et al 1988 paper. */</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="comment">/* The data comes in mm/hr and it needs to be in cm/month */</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        return_value.<a class="code" href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> * 0.1 * (1/24 * 30) / (18 * (0.2 + 0.7 * soil_sand_content));</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        return_value.<a class="code" href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = 0.0;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    }</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160; </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    return_value.<a class="code" href="structsoil_m_l__str.html#a50be45bf1a7676b85f348d2a38d900b7">rcoefPhoto</a> = (wsPhotoCol/layers);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    return_value.<a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> = <a class="code" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    return_value.<a class="code" href="structsoil_m_l__str.html#aff37ff3493aa80130290d80445e09c03">rcoefSpleaf</a> = (LeafWSCol/layers);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    return_value.<a class="code" href="structsoil_m_l__str.html#a1181d419ee6ec88951ccc5d991626005">SoilEvapo</a> = Sevap;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">return</span> return_value;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;}</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">/* Respiration. It is assumed that some of the energy produced by the</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">   plant has to be used in basic tissue maintenance. This is handled</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">   quite empirically by some relationships developed by McCree (1970)</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">   and Penning de Vries (1972) */</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#a668682ce55f6888ab3ec44a7d7a48d07">  903</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#aeb35169469ef33705592a28743d105bf">resp</a>(<span class="keywordtype">double</span> comp, <span class="keywordtype">double</span> mrc, <span class="keywordtype">double</span> temp) {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordtype">double</span> ans = comp *  (1 - (mrc * pow(2, (temp / 10.0))));</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordflow">if</span> (ans &lt;0) ans = 0;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;}</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="keyword">struct </span><a class="code" href="structseq_r_d__str.html">seqRD_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#a668682ce55f6888ab3ec44a7d7a48d07">seqRootDepth</a>(double to, int lengthOut ) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordtype">double</span> by = to / lengthOut;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keyword">struct </span><a class="code" href="structseq_r_d__str.html">seqRD_str</a> result;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= lengthOut; ++i) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        result.<a class="code" href="structseq_r_d__str.html#a510f69db6ac897b84a1d62973c365234">rootDepths</a>[i] = i * by;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;}</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="keyword">struct </span><a class="code" href="structrd__str.html">rd_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>(int n_layers, double rootDepth, double *depths, <span class="keywordtype">double</span> rfl)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;{</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">     * Calculate the fraction of total root mass for each layer in `depths` assuming the mass</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">     * is follows a Poisson distribution along the depth.</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">     * Returns a struct with one array of size `n_layers`.</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">     * Each element in the array is the fraction of total root mass in that layer.</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">     * The sum of all elements of the result equals 1.</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordtype">double</span> layerDepth = 0.0;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordtype">double</span> CumLayerDepth = 0.0;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordtype">int</span> CumRootDist = 1;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>[n_layers];</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordtype">double</span> cumulative_a = 0.0;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n_layers; ++i) {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            layerDepth = depths[1];</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            layerDepth = depths[i] - depths[i-1];</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        CumLayerDepth += layerDepth;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keywordflow">if</span> (rootDepth &gt; CumLayerDepth) {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            CumRootDist++;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n_layers; ++j) {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordflow">if</span> (j &lt; CumRootDist) {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <span class="keywordtype">double</span> a = <a class="code" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a>(j + 1, (<span class="keywordtype">double</span>)CumRootDist * rfl);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>[j] = a;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            cumulative_a += a;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>[j] = 0;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keyword">struct </span><a class="code" href="structrd__str.html">rd_str</a> result;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; n_layers; ++k) {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        result.<a class="code" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[k] = <a class="code" href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a>[k] / cumulative_a;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordflow">return</span>  result;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;}</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#ad89278eed741e51c6e3b8e5c0d97318c">  971</a></span>&#160;<a class="code" href="structsoil_text__str.html">soilText_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c">get_soil_properties</a>(<span class="keywordtype">int</span> soiltype) {</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c">get_soil_properties</a>(<span class="keyword">static_cast&lt;</span><a class="code" href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1">SoilType</a><span class="keyword">&gt;</span>(soiltype));</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;}</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#af355fd8964ae8eef5aad1c74a4ed0771">  975</a></span>&#160;<span class="keyword">const</span> <a class="code" href="structsoil_text__str.html">soilText_str</a> <a class="code" href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c">get_soil_properties</a>(<a class="code" href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1">SoilType</a> soiltype)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;{</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_aux_bio_cro_8h.html#a132d736e080fb28f7c4fde8561b02934">soil_parameters</a>.at(soiltype);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;}</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8h.html#a41bd46cc890d7f155b94296c1db63fc3">  980</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="_aux_bio_cro_8cpp.html#a41bd46cc890d7f155b94296c1db63fc3">arrhenius_exponent</a>(<span class="keywordtype">double</span> c, <span class="keywordtype">double</span> activation_energy, <span class="keywordtype">double</span> thermodynamic_temperature) {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    constexpr <span class="keywordtype">double</span> R = 8.314472; <span class="comment">// joule / kelvin / mole.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">return</span> exp(c - activation_energy / (R * thermodynamic_temperature));</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;};</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructrd__str_html"><div class="ttname"><a href="structrd__str.html">rd_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00137">AuxBioCro.h:137</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a3e62632af7e955b9472586862b286feb"><div class="ttname"><a href="struct_light__profile.html#a3e62632af7e955b9472586862b286feb">Light_profile::direct_irradiance</a></div><div class="ttdeci">double direct_irradiance[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00029">AuxBioCro.h:29</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a668682ce55f6888ab3ec44a7d7a48d07"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a668682ce55f6888ab3ec44a7d7a48d07">seqRootDepth</a></div><div class="ttdeci">struct seqRD_str seqRootDepth(double to, int lengthOut)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00903">AuxBioCro.cpp:912</a></div></div>
<div class="ttc" id="astruct_light__profile_html_ab1cb927f9aec47ac40e504ec039a7573"><div class="ttname"><a href="struct_light__profile.html#ab1cb927f9aec47ac40e504ec039a7573">Light_profile::scattered_irradiance</a></div><div class="ttdeci">double scattered_irradiance[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00030">AuxBioCro.h:30</a></div></div>
<div class="ttc" id="astructws__str_html_a365dc60f2331a4280fc2be55b822191c"><div class="ttname"><a href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">ws_str::runoff</a></div><div class="ttdeci">double runoff</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00058">AuxBioCro.h:58</a></div></div>
<div class="ttc" id="astruct_light__profile_html"><div class="ttname"><a href="struct_light__profile.html">Light_profile</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00028">AuxBioCro.h:28</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_ac321dc561843cb5d3f74604036a3a8da"><div class="ttname"><a href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">ET_Str::Deltat</a></div><div class="ttdeci">double Deltat</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00042">AuxBioCro.h:42</a></div></div>
<div class="ttc" id="astruct_e_t___str_html"><div class="ttname"><a href="struct_e_t___str.html">ET_Str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00038">AuxBioCro.h:38</a></div></div>
<div class="ttc" id="ac4photo_8h_html"><div class="ttname"><a href="c4photo_8h.html">c4photo.h</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_aeb35169469ef33705592a28743d105bf"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#aeb35169469ef33705592a28743d105bf">resp</a></div><div class="ttdeci">double resp(double comp, double mrc, double temp)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00903">AuxBioCro.cpp:903</a></div></div>
<div class="ttc" id="astructseq_r_d__str_html_a510f69db6ac897b84a1d62973c365234"><div class="ttname"><a href="structseq_r_d__str.html#a510f69db6ac897b84a1d62973c365234">seqRD_str::rootDepths</a></div><div class="ttdeci">double rootDepths[MAXLAY+1]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00132">AuxBioCro.h:132</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_a53d1afc42e3609e6eb8145169c7b5aaf"><div class="ttname"><a href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">ET_Str::TransR</a></div><div class="ttdeci">double TransR</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00039">AuxBioCro.h:39</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a32f5636a03443547a8c316772610c4c1"><div class="ttname"><a href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1">SoilType</a></div><div class="ttdeci">SoilType</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00095">AuxBioCro.h:95</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ac010f205c5523680171638102192ce39"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ac010f205c5523680171638102192ce39">leaf_boundary_layer_conductance</a></div><div class="ttdeci">double leaf_boundary_layer_conductance(double windspeed, double leafwidth, double air_temperature, double delta_t, double stomcond, double water_vapor_pressure)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00486">AuxBioCro.cpp:486</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a132d736e080fb28f7c4fde8561b02934"><div class="ttname"><a href="_aux_bio_cro_8h.html#a132d736e080fb28f7c4fde8561b02934">soil_parameters</a></div><div class="ttdeci">const std::map&lt; SoilType, soilText_str &gt; soil_parameters</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00113">AuxBioCro.h:113</a></div></div>
<div class="ttc" id="astructseq_r_d__str_html"><div class="ttname"><a href="structseq_r_d__str.html">seqRD_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00131">AuxBioCro.h:131</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a57179778cb6aed95fb9f484b55873d6f"><div class="ttname"><a href="_aux_bio_cro_8h.html#a57179778cb6aed95fb9f484b55873d6f">MAXLAY</a></div><div class="ttdeci">#define MAXLAY</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00018">AuxBioCro.h:17</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a117fba2c85ba6d52345e7cefc05a43ff"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a></div><div class="ttdeci">double saturation_vapor_pressure(double air_temperature)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00325">AuxBioCro.cpp:325</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html"><div class="ttname"><a href="structsoil_m_l__str.html">soilML_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00062">AuxBioCro.h:62</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a240cad92527a319dd4e8e0d32cd821e6"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a240cad92527a319dd4e8e0d32cd821e6">soilML</a></div><div class="ttdeci">struct soilML_str soilML(double precipit, double transp, double *cws, double soildepth, double *depths, double soil_field_capacity, double soil_wilting_point, double soil_saturation_capacity, double soil_air_entry, double soil_saturated_conductivity, double soil_b_coefficient, double soil_sand_content, double phi1, double phi2, int wsFun, int layers, double rootDB, double LAI, double k, double AirTemp, double IRad, double winds, double RelH, int hydrDist, double rfl, double rsec, double rsdf, double soil_clod_size, double soil_reflectance, double soil_transmission, double specific_heat, double stefan_boltzman)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00604">AuxBioCro.cpp:712</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a5272d35a20edaa0de28ca4ccae5b10a5"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a5272d35a20edaa0de28ca4ccae5b10a5">EvapoTrans2</a></div><div class="ttdeci">struct ET_Str EvapoTrans2(const double Rad, const double Iave, const double airTemp, const double RH, double WindSpeed, const double LeafAreaIndex, double CanopyHeight, const double stomatal_conductance, const double leaf_width, const int eteq)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00325">AuxBioCro.cpp:335</a></div></div>
<div class="ttc" id="astruct_light__model_html_af61792bb688d2e49204bea84f2074ef0"><div class="ttname"><a href="struct_light__model.html#af61792bb688d2e49204bea84f2074ef0">Light_model::cosine_zenith_angle</a></div><div class="ttdeci">double cosine_zenith_angle</div><div class="ttdef"><b>Definition:</b> <a href="_bio_cro_8h_source.html#l00012">BioCro.h:12</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ae316a7cc0aa11d92732e36c4665361ce"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ae316a7cc0aa11d92732e36c4665361ce">water_latent_heat_of_vaporization_henderson</a></div><div class="ttdeci">double water_latent_heat_of_vaporization_henderson(double temperature)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00309">AuxBioCro.cpp:309</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a29eacaa214f1899c9df199ac80d0e1ca"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a29eacaa214f1899c9df199ac80d0e1ca">sunML</a></div><div class="ttdeci">Light_profile sunML(double Idir, double Idiff, double LAI, int nlayers, double cosTheta, double kd, double chil, double heightf)</div><div class="ttdoc">Computation of an n-layered light profile from the direct light Idir, diffuse light Idiff,...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00149">AuxBioCro.cpp:149</a></div></div>
<div class="ttc" id="astructws__str_html_a26953bee326ec08f079e24838fc8feb6"><div class="ttname"><a href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">ws_str::Nleach</a></div><div class="ttdeci">double Nleach</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00059">AuxBioCro.h:59</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ae4f33badbbdb16dada45516a54bdc4a0"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ae4f33badbbdb16dada45516a54bdc4a0">SoilEvapo</a></div><div class="ttdeci">double SoilEvapo(double LAI, double k, double air_temperature, double ppfd, double soil_water_content, double fieldc, double wiltp, double winds, double RelH, double rsec, double soil_clod_size, double soil_reflectance, double soil_transmission, double specific_heat, double stefan_boltzman)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00536">AuxBioCro.cpp:536</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a1181d419ee6ec88951ccc5d991626005"><div class="ttname"><a href="structsoil_m_l__str.html#a1181d419ee6ec88951ccc5d991626005">soilML_str::SoilEvapo</a></div><div class="ttdeci">double SoilEvapo</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00068">AuxBioCro.h:68</a></div></div>
<div class="ttc" id="astructsoil_text__str_html"><div class="ttname"><a href="structsoil_text__str.html">soilText_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00082">AuxBioCro.h:82</a></div></div>
<div class="ttc" id="astruct_light__model_html_adbd9b09d7568e85d0f64380f3dcdcb47"><div class="ttname"><a href="struct_light__model.html#adbd9b09d7568e85d0f64380f3dcdcb47">Light_model::direct_irradiance_fraction</a></div><div class="ttdeci">double direct_irradiance_fraction</div><div class="ttdef"><b>Definition:</b> <a href="_bio_cro_8h_source.html#l00010">BioCro.h:10</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_abca736d0dd36b9f00cbd9dcd72ebcf14"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#abca736d0dd36b9f00cbd9dcd72ebcf14">watstr</a></div><div class="ttdeci">struct ws_str watstr(double precipit, double evapo, double cws, double soildepth, double fieldc, double wiltp, double phi1, double phi2, double soil_saturation_capacity, double sand, double Ks, double air_entry, double b)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00604">AuxBioCro.cpp:657</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a81eccf5a903a575f17d799d959397f61"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a81eccf5a903a575f17d799d959397f61">cos_zenith_angle</a></div><div class="ttdeci">double cos_zenith_angle(const double latitude, const int day_of_year, const double hour_of_day)</div><div class="ttdoc">Computation of the cosine of the zenith angle from latitute (lat), day of the year (DOY),...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00072">AuxBioCro.cpp:72</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_ab5c89562271d3c87e310c002806858ae"><div class="ttname"><a href="structsoil_m_l__str.html#ab5c89562271d3c87e310c002806858ae">soilML_str::rootDist</a></div><div class="ttdeci">double rootDist[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00069">AuxBioCro.h:69</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a61f0087975de6eb7f7434b4cfc0e51ae"><div class="ttname"><a href="struct_light__profile.html#a61f0087975de6eb7f7434b4cfc0e51ae">Light_profile::sunlit_fraction</a></div><div class="ttdeci">double sunlit_fraction[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00033">AuxBioCro.h:33</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ad5f0fc680176f312e47c32701ce779f7"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ad5f0fc680176f312e47c32701ce779f7">WINDprof</a></div><div class="ttdeci">void WINDprof(double WindSpeed, double LAI, int nlayers, double *wind_speed_profile)</div><div class="ttdoc">RH and Wind profile function.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00233">AuxBioCro.cpp:233</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ac5f31df2b025300918f031bf8f1e51d9"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ac5f31df2b025300918f031bf8f1e51d9">lightME</a></div><div class="ttdeci">Light_model lightME(const double latitude, const int day_of_year, const double hour_of_day)</div><div class="ttdoc">Light Macro Environment.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00095">AuxBioCro.cpp:95</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a6979290fdcfafddf3aaa343a367c1f81"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a6979290fdcfafddf3aaa343a367c1f81">dry_air_density</a></div><div class="ttdeci">double dry_air_density(const double air_temperature, const double air_pressure)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00290">AuxBioCro.cpp:290</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a9da7a4e25e646b0be31ac3bbec73f60d"><div class="ttname"><a href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">soilML_str::cws</a></div><div class="ttdeci">double cws[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00065">AuxBioCro.h:65</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a32f5636a03443547a8c316772610c4c1a88336b5bb2a1cc21bac7cf33fd451270"><div class="ttname"><a href="_aux_bio_cro_8h.html#a32f5636a03443547a8c316772610c4c1a88336b5bb2a1cc21bac7cf33fd451270">SoilType::sand</a></div><div class="ttdeci">@ sand</div></div>
<div class="ttc" id="astruct_light__profile_html_afd3e2606cc8df6a9a1809cd7a1696262"><div class="ttname"><a href="struct_light__profile.html#afd3e2606cc8df6a9a1809cd7a1696262">Light_profile::total_irradiance</a></div><div class="ttdeci">double total_irradiance[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00032">AuxBioCro.h:32</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a6b156f63a9c5f2185dcb004e85518998"><div class="ttname"><a href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">soilML_str::drainage</a></div><div class="ttdeci">double drainage</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00066">AuxBioCro.h:66</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_add002b19ebc8390b467dd10c31bb2cb5"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a></div><div class="ttdeci">double poisson_density(int x, double lambda)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00023">AuxBioCro.cpp:23</a></div></div>
<div class="ttc" id="astructws__str_html"><div class="ttname"><a href="structws__str.html">ws_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00055">AuxBioCro.h:55</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a05f381bbff6170709a8d0e2e34f4556a"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a></div><div class="ttdeci">double TempToSFS(double air_temperature)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00319">AuxBioCro.cpp:319</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ad89278eed741e51c6e3b8e5c0d97318c"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ad89278eed741e51c6e3b8e5c0d97318c">get_soil_properties</a></div><div class="ttdeci">soilText_str get_soil_properties(int soiltype)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00971">AuxBioCro.cpp:971</a></div></div>
<div class="ttc" id="a_bio_cro_8h_html"><div class="ttname"><a href="_bio_cro_8h.html">BioCro.h</a></div></div>
<div class="ttc" id="astruct_light__model_html_a5a75f578f4b205eab5fdd6d95ac2961e"><div class="ttname"><a href="struct_light__model.html#a5a75f578f4b205eab5fdd6d95ac2961e">Light_model::diffuse_irradiance_fraction</a></div><div class="ttdeci">double diffuse_irradiance_fraction</div><div class="ttdef"><b>Definition:</b> <a href="_bio_cro_8h_source.html#l00011">BioCro.h:11</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a26953bee326ec08f079e24838fc8feb6"><div class="ttname"><a href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">soilML_str::Nleach</a></div><div class="ttdeci">double Nleach</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00067">AuxBioCro.h:67</a></div></div>
<div class="ttc" id="astruct_light__profile_html_ac496d43dbe3b235431f0cb1bb11c75ff"><div class="ttname"><a href="struct_light__profile.html#ac496d43dbe3b235431f0cb1bb11c75ff">Light_profile::diffuse_irradiance</a></div><div class="ttdeci">double diffuse_irradiance[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00031">AuxBioCro.h:31</a></div></div>
<div class="ttc" id="astructrd__str_html_ab5c89562271d3c87e310c002806858ae"><div class="ttname"><a href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rd_str::rootDist</a></div><div class="ttdeci">double rootDist[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00138">AuxBioCro.h:138</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a9271d425f0a7fe98406dc25f2e148bb4"><div class="ttname"><a href="struct_light__profile.html#a9271d425f0a7fe98406dc25f2e148bb4">Light_profile::height</a></div><div class="ttdeci">double height[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00035">AuxBioCro.h:35</a></div></div>
<div class="ttc" id="astruct_light__model_html"><div class="ttname"><a href="struct_light__model.html">Light_model</a></div><div class="ttdef"><b>Definition:</b> <a href="_bio_cro_8h_source.html#l00009">BioCro.h:9</a></div></div>
<div class="ttc" id="astructws__str_html_ac2f458ad74016a5af57f18d9774bb0d9"><div class="ttname"><a href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">ws_str::psim</a></div><div class="ttdeci">double psim</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00057">AuxBioCro.h:57</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ada4de667caf80cb05fccaff44cccb9b1"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ada4de667caf80cb05fccaff44cccb9b1">rootDist</a></div><div class="ttdeci">struct rd_str rootDist(int n_layers, double rootDepth, double *depths, double rfl)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00903">AuxBioCro.cpp:922</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a2905c23b422ad454d9577841ca594d0d"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a2905c23b422ad454d9577841ca594d0d">LNprof</a></div><div class="ttdeci">void LNprof(double LeafN, double LAI, int nlayers, double kpLN, double *leafN_profile)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00274">AuxBioCro.cpp:274</a></div></div>
<div class="ttc" id="astructws__str_html_aa293628634276d793267cbf2542ce2e2"><div class="ttname"><a href="structws__str.html#aa293628634276d793267cbf2542ce2e2">ws_str::awc</a></div><div class="ttdeci">double awc</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00056">AuxBioCro.h:56</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a50be45bf1a7676b85f348d2a38d900b7"><div class="ttname"><a href="structsoil_m_l__str.html#a50be45bf1a7676b85f348d2a38d900b7">soilML_str::rcoefPhoto</a></div><div class="ttdeci">double rcoefPhoto</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00063">AuxBioCro.h:63</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_aff37ff3493aa80130290d80445e09c03"><div class="ttname"><a href="structsoil_m_l__str.html#aff37ff3493aa80130290d80445e09c03">soilML_str::rcoefSpleaf</a></div><div class="ttdeci">double rcoefSpleaf</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00064">AuxBioCro.h:64</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a41bd46cc890d7f155b94296c1db63fc3"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a41bd46cc890d7f155b94296c1db63fc3">arrhenius_exponent</a></div><div class="ttdeci">double arrhenius_exponent(double c, double activation_energy, double thermodynamic_temperature)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00980">AuxBioCro.cpp:980</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_aa4d2cdd07093428af4830f4c8afd660c"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#aa4d2cdd07093428af4830f4c8afd660c">RHprof</a></div><div class="ttdeci">void RHprof(double RH, int nlayers, double *relative_humidity_profile)</div><div class="ttdoc">Preconditions: RH is between 0 and 1.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00255">AuxBioCro.cpp:255</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ae810651283c6640ef4669d0eede1c942"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ae810651283c6640ef4669d0eede1c942">TempToLHV</a></div><div class="ttdeci">double TempToLHV(double air_temperature)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00301">AuxBioCro.cpp:301</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a058be0e6ed718b377d7c6056cceb09a8"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a058be0e6ed718b377d7c6056cceb09a8">compute_wsPhoto</a></div><div class="ttdeci">double compute_wsPhoto(int wsFun, double fieldc, double wiltp, double phi1, double awc)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00604">AuxBioCro.cpp:604</a></div></div>
<div class="ttc" id="astruct_light__profile_html_a0e8db02a88bb67528a3719bccff28ab3"><div class="ttname"><a href="struct_light__profile.html#a0e8db02a88bb67528a3719bccff28ab3">Light_profile::shaded_fraction</a></div><div class="ttdeci">double shaded_fraction[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00034">AuxBioCro.h:34</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a6380d8cd4192408df76baefe6b369a70"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a></div><div class="ttdeci">double TempToDdryA(double air_temperature)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00284">AuxBioCro.cpp:284</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_567355a66c5b87dfe03a58cbdce72993.html">module_library</a></li><li class="navelem"><a class="el" href="_aux_bio_cro_8cpp.html">AuxBioCro.cpp</a></li>
    <li class="footer">Generated on Tue Oct 20 2020 17:34:40 for The BioCro C++ Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
